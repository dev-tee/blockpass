<!DOCTYPE html>
<html lang="de">
<head>

  <!-- Basic Page Needs
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta charset="utf-8">
  <title>Contract Manager</title>

  <!-- Mobile Specific Metas
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <!-- CSS
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <link rel="stylesheet" type="text/css" href="../css/normalize.css">
  <link rel="stylesheet" type="text/css" href="../css/skeleton.css">
  <link rel="stylesheet" type="text/css" href="../css/style.css">
  <link rel="stylesheet" type="text/css" href="../css/credentials.css">

  <!-- Favicon
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <!-- <link rel="icon" type="image/png" href="images/favicon.png"> -->

  <!-- Javascript
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script type="text/javascript" src="../scripts/web3.js"></script>
  <script type="text/javascript" src="../scripts/init3.js"></script>
  <script type="text/javascript" src="../scripts/api.js"></script>
  <script type="text/javascript">

    // List all contracts the api knows about.
    // This does not mean the contract manager knows about them as well.
    function listContracts() {
      var output = [];
      for (var i = contractNames.length - 1; i >= 0; i--) {
        output.push(
          '<li>', contractInstances[i].address, ' - ', contractNames[i], '</li>'
        );
      }
      document.getElementById('contracts').innerHTML = '<ul>' + output.join('') + '</ul>';
    }

    // Register all contracts with the contract manager.
    function registerContracts(event) {
      if (event.preventDefault) event.preventDefault();

      for (var i = contractNames.length - 1; i >= 0; i--) {
        if (contractNames[i] == 'contractprovider' || contractNames[i] == 'contractmanager') {
          continue;
        }
        var data = contractmanagerInstance.addContract.getData(contractNames[i], contractInstances[i].address);
        console.log("Registering: " + contractNames[i] + " at " + contractInstances[i].address);
        send(data);
      }
    }

    // Send the transaction with the specified data.
    // Sign it using the address and password in the form.
    function send(data) {
      var tx = {
        "from": document.getElementById('account').value,
        "to": contractmanagerInstance.address,
        "data": data,
        "gasPrice": 0
      };
      tx.gas = web3.eth.estimateGas(tx);
      console.log("Estimated gas cost: " + tx.gas);
      web3.personal.sendTransaction(tx, document.getElementById('password').value);
    }
  </script>
</head>
<body>

  <!-- Primary Page Layout
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <div class="container">
    <div class="row">
      <div class="column center-column credentials">
        <form id="form">
          <label for="account">Adresse:</label>
          <input id="account" type="text" class="u-full-width" placeholder="0x00a329c0648769A73afAc7F9381E08FB43dBEA72" required>
          <label for="password">Passwort:</label>
          <input id="password" type="password" class="u-full-width" placeholder="*******">
          <button id="register">Registriere Contracts</button>
        </form>
        <div id="contracts"></div>
      </div>
    </div>
  </div>

  <!-- Javascript [EventListeners]
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
  <script type="text/javascript">
    document.getElementById('form').addEventListener('submit', registerContracts);
  </script>

  <!-- End Document
  –––––––––––––––––––––––––––––––––––––––––––––––––– -->
</body>
</html>
